"use strict";function toggleMain(toggleClass,toggleType,select){switch(select=select||"",toggleType){case"remove":jQuery("#main-311"+select).removeClass(toggleClass);break;case"add":jQuery("#main-311"+select).addClass(toggleClass);break;default:jQuery("#main-311"+select).toggleClass(toggleClass)}}angular.module("app",["ui.router","drupalService","seeClickFixService","paymentService","app.menu","app.proudcity","app.showcase","app.lazyCompile","app.social","app.proudcityImage","app.map","scrollTo","metaInfo","ngSanitize","ngResource","google.places","ngTouch","iso.directives","stripe.checkout","angular-inview"]).run(["$rootScope","$state","$stateParams","metaInfo","$window","$location",function($rootScope,$state,$stateParams,metaInfo,$window,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.currentSection="",$rootScope.currentRoute="",$rootScope.appUrl="",$rootScope.apiUrl="http://demo.helmcivic.com/",$rootScope.vocabularyVid=2,$rootScope.trackUrl="http://markaspot.helmcivic.com/georeport/v2",$rootScope.seeclickfixUrl="https://test.seeclickfix.com/api/v2/",$rootScope.mapboxAccessToken="pk.eyJ1IjoiYWxiYXRyb3NzZGlnaXRhbCIsImEiOiI1cVUxbUxVIn0.SqKOVeohLfY0vfShalVDUw",$rootScope.mapboxMap="albatrossdigital.lpkdpcjb",$rootScope.app_page_display="all",$rootScope.appPageDisplay="all",$rootScope.proudShowcaseKey="325jk154hl3y8r2J34NRAasdfasdf",$rootScope.showcaseApiUrl="http://ui.dev.getproudcity.com/",$rootScope.proudcityApi="http://proud.dev.getproudcity.com/api/proudcity/",$rootScope.proxyUrl=$rootScope.proudcityApi+"proxy",$rootScope.paymentUrl=$rootScope.proudcityApi+"invoice-example",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if($rootScope.startedActive=!1,toState.data){var title=toState.data.title&&toState.data.title.length?toState.data.title:"";metaInfo.setTitle(title);var description=toState.data.description&&toState.data.description.length?toState.data.description:"";metaInfo.setMetaDescription(description);var keywords=toState.data.keywords&&toState.data.keywords.length?toState.data.keywords:[];metaInfo.setMetaKeywords(keywords,toState.data.keywordAppend)}else fromState.data&&metaInfo.resetAll()}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$window.ga&&$window.ga("send","pageview",{page:$location.path(),title:toState.data&&toState.data.title?toState.data.title:"ProudCity"}),fromState.name&&fromState.name.length&&_.get(toState,"data.doScroll")&&$rootScope.scrollTo("main",null,!0)}),$rootScope.goSubRoute=function(baseRoute,subRoute,baseName){baseName=void 0==baseName?"base":baseName;var stateName=baseRoute+"."+subRoute;try{var state=$state.get(stateName);if(void 0==state||null==state)throw"myException"}catch(e){stateName=baseRoute+"."+baseName}$state.go(stateName)},$rootScope.getPageSection=function(){var name=$rootScope.$state.current.name;return name==$rootScope.currentRoute?$rootScope.currentSection:($rootScope.currentRoute=name,name=name?name.indexOf(".")>0?"section-"+name.substring(0,name.indexOf(".")):"section-"+name:"section",$rootScope.currentSection=name,name)}}]).config(["$locationProvider","$stateProvider","$urlRouterProvider","metaInfoProvider","StripeCheckoutProvider",function($locationProvider,$stateProvider,$urlRouterProvider,metaInfoProvider,StripeCheckoutProvider){metaInfoProvider.setBaseTitle("ProudCity"),metaInfoProvider.setBaseDescription("Digital government as a public service."),metaInfoProvider.setBaseKeywords("municipal website, city website, digital front door, opengov"),$locationProvider.html5Mode(!0),StripeCheckoutProvider.defaults({key:"pk_2Z9o15fO6InYzHSWk9GDeRmbuCWQ9"})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.when(/get\/[a-zA-z]*\/[a-zA-z]*$/i,["$match","$stateParams",function($match,$stateParams){return $match.input+"/answers"}]),$stateProvider.state("home",{url:"/",data:{doScroll:!0},templateUrl:"views/home.html",controller:function($scope,$rootScope,$state,$filter){}}).state("start",{url:"/start",data:{doScroll:!0},templateUrl:"views/start.html",controller:function($scope,$rootScope,$state,$filter){}}).state("about",{url:"/about",data:{doScroll:!0},templateUrl:"views/about.html",controller:function($scope,$rootScope,$state,$filter){}}).state("pricing",{url:"/pricing",data:{doScroll:!0},templateUrl:"views/pricing.html",controller:function($scope,$rootScope,$state,$filter){}}).state("contact",{url:"/contact",data:{doScroll:!0},templateUrl:"views/contact.html",controller:function($scope,$rootScope,$state,$filter,$http){$scope.form={},$scope.status=!1,$scope.submit=function(form){$http.post($rootScope.proudcityApi+"contact",form).then(function(response){$scope.status="thanks"},function(response){$scope.status="error"})}}}).state("support",{url:"/support",data:{doScroll:!0},templateUrl:"views/support.html",controller:function($scope,$rootScope,$state,$filter){}}).state("developers",{url:"/developers",data:{doScroll:!0},templateUrl:"views/developers.html",controller:function($scope,$rootScope,$state,$filter){}}).state("careers",{url:"/careers",data:{doScroll:!0},templateUrl:"views/careers.html",controller:function($scope,$rootScope,$state,$filter){}}).state("features",{url:"/features",data:{doScroll:!0},templateUrl:"views/features.html",controller:function($scope,$rootScope,$state,$filter){$scope.primary=[{title:"Resident-focused",icon:"",desc:"ProudCity focuses on the needs of your residents. Emphasizing search and employing analytics to get your residents where they need to go in as few steps as possible."},{title:"Mobile-friendly",icon:"",desc:"Mobile, tablet, desktop, TV, kiosk. Your website will be functional and beautiful no matter the format."},{title:"Secure and reliable",icon:"",desc:"We host in secure data centers with up-to-date software, scheduled backups and all pages served over https for ultimate privacy. "},{title:"Web-based content management",icon:"",desc:"We use an enterprise-class CMS built to manage million-page websites. Our content editor, media manager and drag-and-drop interface empowers anyone to easily manage their digital services."}],$scope.primary2=[{title:"Cloud hosted",icon:"",desc:"ProudCity is a cloud-based, OpenSaaS platform. We manage your website hosting so you and your IT department can focus on more important work."},{title:"SLA support",icon:"",desc:"To ensure peace of mind, we provide 99.9% uptime guarantee and 24/7 phone support."},{title:"Universal updates",icon:"",desc:"We update the ProudCity platform are pushed to your website automatically, and without expensive upgrade fees."},{title:"Flexible migration",icon:"",desc:"Our Content Liftoff integration makes importing agency websites -- from MS Word, Google Drive or an existing website -- a collaborative, painless experience."}],$scope.primary3=[{title:"Issue reporting",icon:"",desc:"Our issue reporting tool lets residents quickly report a problem with location and photos from any device."},{title:"Agency websites",icon:"",desc:"Empower agencies with their own websites while remaining under the city’s umbrella by centralizing permissions and content workflow."},{title:"Administrative permissions and workflow",icon:"",desc:"Manage internal user permissions and email alerts as content moves from draft to to published."},{title:"Accessibility",icon:"",desc:"Addressing the needs of all residents is important. Our structured markup meets Web Content Accessibility Guidelines Working Group (WCAG) level 2 standards."},{title:"Web analytics dashboard",icon:"",desc:"Integration with Google Analytics brings insights into traffic trends and popular content and helps you better understand how residents are using your site."},{title:"Services map",icon:"",desc:"Highlight services -- fire, schools, parks, city administration -- on a pre-populated map with data from Foursquare. We can also integrate with other content such as public transit, events and hiking maps."},{title:"100% data and code export",icon:"",desc:"ProudCity is an open source project, licensed under GNU General Public License, version 2 or later. At anytime, you can export your database and files to host elsewhere."},{title:"3rd party integrations",icon:"",desc:"ProudCity integrates with (a growing list of) applications, making it easy to add popular and civic-specific services to your digital government platform (see integrations)."},{title:"Flexible onboarding and transitioning",icon:"",desc:"Baked into our 3-step process you’ll have a Beta standing next to your legacy website to ensure a smooth transition to your new government digital services."},{title:"Elicit Feedback",icon:"",desc:"Built into our Answers app we allow for residents’ questions to be responded to."},{title:"Community",icon:"",desc:'We’re building out a ProudCity Slack community to  create a knowledge-base for government  digital services. <a href="/contact">Request an invite today</a>.'},{title:"SEO best practices",icon:"",desc:"Markup is standards-compliant and rich with SEO metatags and social integration.  Google Analytics is  built in to keep track of results and make iterative improvements."},{title:"Solr search with Google integration",icon:"",desc:"Our smart autocomplete helps visitors find what they are looking for instantly.  For deeper searches a customized, embedded version of Google searches all of your city's subsites."},{title:"Media embedding",icon:"",desc:"Easily upload and add video, audio and photos to your mobile responsive web pages."},{title:"Integrate existing branding",icon:"",desc:"Like each ProudCity, your branding is unique to your city. ProudCity empowers you to integrate branding in 30 seconds instead of 6 months. "},{title:"Document archive and library",icon:"",desc:"Not everything is online so having a document repository of City Council Minutes, Regulations and Forms  to search, view, share or print is a must have digital service."},{title:"Webforms",icon:"",desc:"Having intuitive online forms for residents starts with the ability for city staff to easily build and manage webforms on their own."},{title:"Open API",icon:"",desc:'In the spirit of being open and flexible ProudCity is architected to easily integrate with Open APIs. See our <a href="/developers">developer page</a> for more detail.'}]}}).state("integrations",{url:"/integrations",data:{doScroll:!0},templateUrl:"views/integrations.html",controller:function($scope,$rootScope,$state,$filter){$scope.services={311:[{title:"SeeClickFix",image:"seeclickfix.png",desc:"Create new issue, lookup issue, view issues on map"},{title:"Mark-a-Spot",image:"markaspot.png",desc:"Create new issue, lookup issue, view issues on map"},{title:"Open311",image:"open311.png",desc:"Lookup issue, view issues on map"}],Payments:[{title:"Stripe",image:"stripe.png",desc:"Process online payments and automate the payment processing workflow"},{title:"Legacy",image:"payment-link.png",desc:"Link to your existing payment provider"}],"Social media":[{title:"Twitter",image:"twitter.png",desc:"View social media across multiple accounts on a social wall"},{title:"Instagram",image:"instagram.png",desc:"View social media across multiple accounts on a social wall"},{title:"Facebook",image:"facebook.png",desc:"View social media across multiple accounts on a social wall"},{title:"YouTube",image:"youtube.png",desc:"View social media across multiple accounts on a social wall"},{title:"RSS",image:"rss.png",desc:"Display new from multiple sources on a social wall. Import existing site news and press releases."},{title:"iCal",image:"ical.png",desc:"Display upcoming events on a social wall. Import existing events to a centralized city calendar."}],Mapping:[{title:"MapBox",image:"mapbox.png",desc:"Create a map that's as unique as your city"},{title:"Foursquare",image:"foursquare.png",desc:"Pre-populate a map with your most popular municipal services"}],Administration:[{title:"Google Analytics",image:"googleanalytics.png",desc:"View traffic details and site trends directly from the administration dashboard"},{title:"Flickr",image:"flickr.png",desc:"Search for and add Creative Commons-licensed photography in the CMS"},{title:"Google Drive",image:"googledrive.png",desc:"Import content from Google Docs, add files from Google Drive"},{title:"Content Liftoff",image:"contentliftoff.png",desc:"Quickly architect, import and manage agency subsites"}],Search:[{title:"Apache Solr",image:"solr.png",desc:"Instant, advanced suggestive search with the open source industry leader"},{title:"Google Search",image:"google.png",desc:"Let visitors search all of your agency subsites with a customized Google Search"}],Translate:[{title:"Google Translate",image:"googletranslate.png",desc:"Quickly add baseline translations for free"}]}}})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.when(/get\/[a-zA-z]*\/[a-zA-z]*$/i,["$match","$stateParams",function($match,$stateParams){return $match.input+"/answers"}]),$stateProvider.state("city",{url:"/get/:state/:city",data:{doScroll:!0},templateUrl:"views/city.html",controller:function($scope,$rootScope,$state,$filter,$http){$scope.mapCompile=!1,$scope.socialCompile=!1,$scope.formShown=!1,$scope.searchActive=!1,$scope.activeModal=!1;var ucWords=function(str){return(str+"").replace("-"," ").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})};$scope.location={state:ucWords($state.params.state),city:ucWords($state.params.city),key:{state:$state.params.state,city:$state.params.city}},$scope.settings={color:{main:"#000",secondary:"#000",highlight:"#2196F3"},header:{backgroundType:"image",backgroundImage:"",backgroundColor:"",searchColor:"#FFFFFF",searchAlign:"left"}},$http.get($rootScope.proudcityApi+"?state="+$state.params.state+"&city="+$state.params.city).success(function(data){$scope.location={city:data.city,county:data.county,state:data.state},angular.extend($scope.settings,data),console.log(JSON.stringify($scope.settings))}),$scope.showMap=function($event,$inview,$inviewpart){$scope.settings.lat&&($scope.mapCompile='<div foursquare-map="$parent.settings"></div>')},$scope.showSocial=function($event,$inview,$inviewpart){$scope.socialCompile="<div social-wall></div>"},$scope.modal=function(e){$scope.toggleModal("getInvolved",e),e.preventDefault()},$scope.toggleModal=function(type,$event){return $rootScope.startedActive=$rootScope.startedActive?!1:!0,$scope.activeModal=type,$event?void $event.preventDefault():!0},$scope.openModal=function(type,$event){$rootScope.startedActive=!0,$scope.activeModal=type},$scope.searchFocus=function(){$scope.searchActive=!0},$scope.searchAutocomplete=function(text){$scope.autocomplete=[{icon:"usd",title:"Pay my water bill",route:"city.payments.type",data:{nid:32}},{icon:"question-circle",title:"How do I get a marriage license?",route:"city.faq.child",data:{tid:19}},{icon:"usd",title:"Pay a parking ticket",route:"city.payments.type",data:{nid:33}},{icon:"question-circle",title:"How do I get a copy of a birth certificate?",route:"city.faq.child",data:{tid:59}},{icon:"exclamation-triangle",title:"File a complaint",route:"city.report"}]},$scope.searchAutocompleteClick=function(item){console.log(item),$scope.searchClose(),$("html, body").animate({scrollTop:$("#wrapper-311").offset().top-70},1e3),$state.go(item.route,item.data)},$scope.searchClose=function(){$scope.searchActive=!1},$scope.lucky=function(){var cities=[{city:"Kennebunkport",state:"Maine"},{city:"Gainesville",state:"Florida"},{city:"Huntsville",state:"Alabama"},{city:"State-College",state:"Pennysylvania"},{city:"Oakland",state:"California"},{city:"Walpole",state:"Massachusetts"},{city:"Sisters",state:"Oregon"},{city:"Pueblo",state:"Colorado"},{city:"Denver",state:"Colorado"},{city:"Corvallis",state:"Oregon"},{city:"Albuquerque",state:"New-Mexico"}],city=cities[Math.floor(Math.random()*cities.length)];console.log(city),$state.go("city",city)}}}).state("city.modal",{url:"/start",templateUrl:"views/city-modal.html",data:{doScroll:!0},controller:function($scope,$rootScope,$state,$filter,$http){}})}]);var services=[{key:"helmcivic",title:"Helm Civic",img:"helmcivic.png",desc:"Complete city website",id:198},{key:"dkan",title:"dkan",img:"dkan.svg",desc:"Open data platform"},{key:"govpress",title:"GovPress",img:"govpress.png",desc:"Wordpress theme for Government"},{key:"markaspot",title:"Markaspot",img:"markaspot.png",desc:"Public Civic Issue Tracking"},{key:"thinkup",title:"ThinkUp",img:"thinkup.png",desc:"Social media insight"}];angular.module("app.showcase",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("showcase",{url:"/showcase",templateUrl:"views/showcase/showcase.html",controller:function($scope,$rootScope,$state,$filter,$http){$scope.services=services,$scope.evaluate=function(key){$state.go("form",{app:key})}}}).state("form",{url:"/showcase/try/:app",templateUrl:"views/showcase/form.html",resolve:{nodes:function($stateParams,Node){return Node.query().$promise.then(function(data){return data.list})}},controller:function($scope,$rootScope,$state,$filter,$http,Node){$scope.key=$state.params.app,$scope.site={key:$scope.key},$scope.getTemplate=function(){return"views/showcase/form/"+$scope.key+".html"},void 0==$rootScope.token&&$http({url:$rootScope.showcaseApiUrl+"restws/session/token?key="+$rootScope.proudShowcaseKey,method:"GET",requestType:"text"}).success(function(data){$rootScope.token=data}),$scope.changeLocation=function(){if(void 0!=$scope.site.location.address_components){var city=$scope.site.location.address_components[0].long_name;$scope.site.siteName=void 0==$scope.site.siteName||""==$scope.site.siteName?city:$scope.site.siteName,$scope.site.machineName=void 0==$scope.site.machineName||""==$scope.site.machineName?city.toLowerCase().replace(" ","-"):$scope.site.machineName}},$scope.submit=function(site){if("has-error"==$scope.machineNameClass)return void alert("Sorry, your machine name is already taken.");var params={type:"environment",field_env_app:{id:198},title:site.machineName,field_env_email:$scope.mail};$http({url:$rootScope.showcaseApiUrl+"node",method:"POST",requestType:"text",headers:{"X-CSRF-Token":$rootScope.token},data:params}).error(function(data){alert("Oops, we ran into an issues. Please contact hello@helmcivic.com and we'll get you set up ASAP.")}).success(function(data){console.log(data),$state.go("loading",{app:site.key,nid:data.nid})})}}}).state("loading",{url:"/showcase/try/:app/loading/:nid",templateUrl:"views/showcase/loading.html",controller:function($scope,$rootScope,$state,$filter,$http,$timeout){$scope.getTemplate=function(){return"views/showcase/loading/"+$scope.key+".html"},$scope.progressValue=0,$timeout(function(){$scope.progressValue=90},2e3)}})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.faq",{url:"/answers",templateUrl:"views/faq/faq.html",data:{title:"FAQ",description:"About the about",keywords:"About, this, page",doScroll:!1},resolve:{terms:function($stateParams,$rootScope,TaxonomyTerm){return TaxonomyTerm.query({vocabulary:$rootScope.vocabularyVid,sort:"weight",direction:"ASC"}).$promise.then(function(data){return data.list})}},controller:function($scope,$rootScope,$state,terms){$scope.terms=terms,$scope.active=null,$scope.childOpen=!1,$scope.open=function(item){$scope.active=item},$scope.openChildren=function(){$scope.childOpen=!0}}}).state("city.faq.child",{url:"/:tid",templateUrl:"views/faq/faq-child.html",data:{title:"FAQ",description:"About the about",keywords:"About, this, page"},controller:function($scope,$rootScope,$state,$filter,terms,Node){$scope.activeTerm=$filter("termByTid")(terms,$state.params.tid),$scope.activeParent=$filter("termByTid")(terms,$scope.activeTerm.parent[0].id),$state.go("city.faq.child.answers",{nid:"list"})}}).state("city.faq.child.answers",{url:"/:nid",templateUrl:"views/faq/faq-child-answers.html",data:{title:"FAQ",description:"About the about",keywords:"About, this, page"},controller:function($scope,$rootScope,$state,$filter,Node){$scope.activeNid="list"!=$state.params.nid?$state.params.nid:null,Node.query({field_faq_category:$state.params.tid,sort:"title",direction:"ASC"}).$promise.then(function(data){$scope.nodes=data.list})}})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.status",{url:"/status",data:{doScroll:!1},templateUrl:"views/issues/issue-status.html",controller:function($scope,$rootScope,$state){}}).state("city.status.item",{url:"/:code",templateUrl:"views/issues/issue-status-result.html",controller:function($scope,$rootScope,$state,TrackIssue){$scope.code=$state.params.code,TrackIssue.get({code:$state.params.code}).$promise.then(function(data){void 0!=data?$scope.item=data:$scope.error=!0,console.log($scope.item)})}}).state("city.report",{url:"/report",data:{doScroll:!1},templateUrl:"views/issues/issue-create-categories.html",resolve:{services:function($stateParams,TrackService,$rootScope){return TrackService.query({address:$stateParams.city+", "+$stateParams.state}).$promise.then(function(data){return void 0!=data.request_types?data.request_types:null})}},controller:function($scope,$rootScope,$state,services){console.log(services);for(var mapping=[{term:"animal",icon:"paw"},{term:"building",icon:"building"},{term:"garbage",icon:"trash-o"},{term:"cemetary",icon:void 0},{term:"weed",icon:"pagelines"},{term:"graffiti",icon:"paint-brush"},{term:"sidewalk",icon:"road"},{term:"street",icon:"road"},{term:"light",icon:"lightbulb-o"},{term:"sign",icon:"map-signs"},{term:"tree",icon:"tree"},{term:"sewer",icon:void 0},{term:"pothole",icon:"car"},{term:"parking",icon:"car"},{term:"car",icon:"car"},{term:"park",icon:"leaf"},{term:"litter",icon:"trash-o"},{term:"recycl",icon:"recycle"}],colors=["#BC2D07","#14A88E","#A4506C","#094558","#F68D38","#67412C"],i=0;i<services.length;i++){services[i].field_icon={color:colors[Math.floor(Math.random()*colors.length)]};for(var title=services[i].title.toLowerCase(),j=0;j<mapping.length;j++)-1!=title.indexOf(mapping[j].term)&&(services[i].field_icon.icon=mapping[j].icon);services[i].field_icon.icon=void 0==services[i].field_icon.icon?"file-text-o":services[i].field_icon.icon}console.log(services),$scope.types=services,$scope.typeUrl=function(url){var type=url.replace($rootScope.seeclickfixUrl+"request_types/","");return"city.report.map({type:'"+type+"'})"}}}).state("city.report.map",{url:"/:type",templateUrl:"views/issues/issue-create-map.html",controller:function($scope,$rootScope,$state,$http){$scope.type=$state.params.type,$scope.config=void 0,$http.get("//workhorse.albatrossdigital.com/proudcity-api.php?state="+$state.params.state+"&city="+$state.params.city).success(function(data){$scope.config=data}),$scope.next=function(){if(console.log(),void 0==$scope.marker)alert("Please enter an address, or click the Locate button to use your current location.");else{var latlng=$scope.marker.getLatLng();$state.go("city.report.map.details",{lat:latlng.lat,lng:latlng.lng})}},$scope.$watch("config",function(value){if(void 0!=$scope.config){L.mapbox.accessToken=$rootScope.mapboxAccessToken;var map=new L.mapbox.Map("issue-map",$rootScope.mapboxMap,{center:new L.LatLng($scope.config.lat,$scope.config.lng),zoom:15,scrollWheelZoom:!1});$scope.marker=null;var addMarker=function(self){var latlng=void 0!=self.latlng?self.latlng:new L.LatLng(self.feature.center[1],self.feature.center[0]);$scope.marker=L.marker(latlng,{icon:L.mapbox.marker.icon({"marker-color":"ff8888"}),draggable:!0}).addTo(map),$scope.$apply()};map.on("click",function(self){null===$scope.marker&&addMarker(self)}),map.addControl(L.mapbox.geocoderControl("mapbox.places",{keepOpen:!0,autocomplete:!0}).on("select",addMarker).on("autoselect",addMarker)),L.control.locate({drawCircle:!0}).addTo(map),map.on("locationfound",addMarker)}})}}).state("city.report.map.details",{url:"/details?lat&lng",templateUrl:"views/issues/issue-create-details.html",resolve:{data:function($stateParams,$rootScope,TrackFields){return TrackFields.get({type:$stateParams.type}).$promise.then(function(data){return console.log(data),{categoryTitle:data.title,fields:data.questions}})}},controller:function($scope,$rootScope,$state,data,$http){$scope.type=$state.params.type,$scope.form={request_type_id:$scope.type,lat:$state.params.lat,lng:$state.params.lng,answers:{}},$scope.fields=data.fields,$scope.form.category=data.categoryTitle,$scope.submit=function(data){console.log(JSON.stringify(data)),$http.post($rootScope.seeclickfixUrl+"issues",data).then(function(response){console.log(response)},function(response){})}}})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider","StripeCheckoutProvider",function($stateProvider,$urlRouterProvider,StripeCheckoutProvider){$stateProvider.state("city.payments",{templateUrl:"views/payment/payment.html",data:{doScroll:!1},url:"/payments",resolve:{nodes:function($stateParams,Node){return Node.query({type:"payment"}).$promise.then(function(data){return data.list})}},controller:function($scope,$rootScope,$state,nodes){$scope.nodes=nodes}}).state("city.payments.type",{templateUrl:"views/payment/payment-type.html",url:"/:nid",resolve:{node:function($stateParams,$filter,nodes){return $filter("filter")(nodes,{nid:$stateParams.nid})[0]},stripe:StripeCheckoutProvider.load},controller:function($scope,$rootScope,$state,node,Payment,StripeCheckout){$scope.node=node,$scope.demoInfo=!1,$scope.payment={number:"",amount:""},$scope.numberClass="",$scope.demoInfoToggle=function(e){$scope.demoInfo=!$scope.demoInfo,console.log($scope.demoInfo),e.preventDefault()},$scope.$watch("payment.number",function(){""!=$scope.payment.number&&$scope.payment.number.length>3?($scope.numberClass="has-warning",Payment.get({city:$scope.location.city,state:$scope.location.state,number:$scope.payment.number},function(data){void 0!=data.amount?($scope.payment.amount=data.amount,$scope.payment.name=data.name,$scope.numberClass="has-success"):($scope.payment.amount="",$scope.numberClass="has-error")})):$scope.numberClass=""});var handler=StripeCheckout.configure({name:node.title,token:function(token,args){}});$scope.submit=function(payment){if(void 0!=$scope.node.field_payment_link)window.location=$scope.node.field_payment_link.replace("[invoice]",payment.number).replace("[amount]",payment.amount);else{var options={description:"Invice "+payment.number,amount:100*$scope.amount};handler.open(options).then(function(result){},function(){})}}}}).state("city.payments.success",{templateUrl:"views/payment/payment-success.html",url:"/:nid/:token",resolve:{node:function($stateParams,$filter,nodes){return $filter("filter")(nodes,{nid:$stateParams.nid})[0]}},controller:function($scope,$rootScope,$state,node,Payment){}})}]),angular.module("metaInfo",[]).provider("metaInfo",function(){var baseTitle="",title="",baseMetaDescription="",metaDescription="",baseMetaKeywords="",metaKeywords="";this.setBaseTitle=function(newTitle){baseTitle=newTitle},this.setBaseDescription=function(description){baseMetaDescription=description},this.setBaseKeywords=function(keywords){baseMetaKeywords=keywords},this.$get=function(){return{title:function(){return title.length?title+" | "+baseTitle:baseTitle},setTitle:function(newTitle){title=newTitle},metaDescription:function(){return metaDescription.length?metaDescription:baseMetaDescription},metaKeywords:function(){return metaKeywords.length?metaKeywords:baseMetaKeywords},setMetaDescription:function(newMetaDescription){metaDescription=newMetaDescription},setMetaKeywords:function(newKeywords,append){var keywords="";for(var key in newKeywords)keywords+=", "+newKeywords[key].name;metaKeywords="undefined"!=typeof append&&append?baseMetaKeywords+keywords:keywords},resetAll:function(){title="",metaDescription="",metaKeywords=""}}}}),angular.module("drupalService",["ngResource"]).factory("Node",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid.json",{nid:"@nid"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1,isArray:!1}})}]).factory("View",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/rest/:entity/:bundle/:a/:b/:c",{entityType:"@entity",name:"@bundle",a:"@arg0"},{query:{method:"GET",cache:!0,isArray:!0}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/taxonomy_term/:tid.json",{vocabulary:"@vocabulary"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermIndex",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"taxonomy_term?vocabulary&sort=weight&direction=ASC",{vocabulary:"@vocabulary"},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermNodes",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/taxonomy_term_nodes",{tid:"@tid"},{})}]).factory("User",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/user/:uid",{uid:"@uid"},{})}]).factory("Comment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid/comments",{nid:"@nid"},{post:{method:"POST",url:"/entity/comment"}})}]).factory("viewsFactory",["View",function(View){var service={};return service.pageLoad=function($scope,params){if(!$scope.loadingPage&&void 0!=$scope.items&&$scope.items.length>0){$scope.currentPage++;var newData=View.query(params,function(){newData.length>0&&(Array.prototype.push.apply($scope.items,newData),$scope.loadingPage=!1)})}$scope.loadingPage=!0},service}]).directive("openReveal",function(){return{restrict:"A",scope:{openReveal:"@"},link:function($scope,$element,$attrs){$element.on("click",function(){jQuery("#"+$scope.openReveal).foundation("reveal","open")})}}}),angular.module("seeClickFixService",["ngResource"]).factory("TrackService",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.seeclickfixUrl+"issues/new?address",{address:"@address"},{query:{isArray:!1}})}]).factory("TrackFields",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.seeclickfixUrl+"request_types/:type",{type:"@type"})}]).factory("TrackIssue",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.seeclickfixUrl+"issues/:code",{code:"@code"},{get:{isArray:!1},save:{headers:{Authorization:"Basic jeff@albatrossdigital.com:test123"}}})}]),angular.module("paymentService",["ngResource"]).factory("Payment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.paymentUrl+"?number",{number:"@number"},{get:{cache:!0}})}]),angular.module("metaInfo").controller("metaInfoCtrl",["$scope","metaInfo",function($scope,metaInfo){$scope.pageTitle=function(){return metaInfo.title()},$scope.metaDescription=function(){return metaInfo.metaDescription()},$scope.metaKeywords=function(){return metaInfo.metaKeywords()}}]),angular.module("app").filter("termByTid",function(){return function(items,tid){for(var i=0;i<items.length;i++)if(parseInt(items[i].tid)==parseInt(tid))return items[i];return null}}).filter("termsNoParent",function(){return function(items){
for(var filtered=[],i=0;i<items.length;i++)0==items[i].parent.length&&filtered.push(items[i]);return filtered}}).filter("termsByParent",function(){return function(items,tid){for(var filtered=[],i=0;i<items.length;i++)for(var j=0;j<items[i].parent.length;j++)items[i].parent[j].id==tid&&filtered.push(items[i]);return filtered}}),angular.module("app").directive("pageReady",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$browser.notifyWhenNoOutstandingRequests(function(){document.body.setAttribute("data-status","ready"),$scope.$root.$emit("pageReady"),$scope.$root.$broadcast("pageReady")})}}}),angular.module("app").directive("scroll",function($window,$rootScope){return function(scope,element,attrs){angular.element($window).bind("scroll",function(){var apply=!1;this.pageYOffset>=100?scope.scrolled||(scope.scrolled=!0,apply=!0):scope.scrolled&&(scope.scrolled=!1,apply=!0),apply&&(scope.$apply(),apply=!1)})}}),angular.module("app.proudcity",[]).directive("proudcityHeader",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcityHeader.html",link:function($scope,$rootScope,$element){$scope.mainMenu=[{title:"Features",state:"features"},{title:"Integrations",state:"integrations"},{title:"Pricing",state:"pricing"},{title:"Contact",state:"contact"}],console.log($scope.menu)}}}).directive("proudcityFooter",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcityFooter.html",scope:{hideForm:"@"},link:function($scope,$rootScope,$element){$scope.footerMenu=[{title:"Features",state:"features"},{title:"Integrations",state:"integrations"},{title:"Pricing",state:"pricing"},{title:"About",state:"about"},{title:"Careers",state:"careers"},{title:"Contact",state:"contact"}]}}}).directive("proudcitySignup",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcitySignup.html",link:function($scope,$rootScope,$element){$scope.form={},$scope.status=!1,$scope.submit=function(form){form.city=$scope.location.city,form.state=$scope.location.state,$http.post($scope.$parent.$parent.proudcityApi+"signup",form).then(function(response){$scope.status="thanks"},function(response){$scope.status="error"})}}}}).directive("proudcityStyle",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcityStyle.html",link:function($scope,$rootScope,$element){}}}).directive("proudcityGetInvolved",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcityGetInvolved.html",link:function($scope,$rootScope,$element){}}}).directive("proudcityStart",function($window,$browser,$http){return{restrict:"A",templateUrl:"views/proudcityStart.html",link:function($scope,$rootScope,$element){$scope.preview=function(){void 0!=$scope.location.address_components&&$scope.$parent.$state.go("city",{city:$scope.location.address_components[0].long_name.replace(" ","-"),state:$scope.location.address_components[2].long_name.replace(" ","-")})},$scope.location=null,$scope.autocompleteOptions={componentRestrictions:{country:"us"},types:["(cities)"]}}}}).directive("getStarted",["$rootScope",function($rootScope){return{restrict:"A",link:function($scope,$element,$attrs){$element.on("click",function(){$rootScope.startedActive=$rootScope.startedActive?!1:!0,$rootScope.$apply()})}}}]),angular.module("app.menu",[]).directive("menu",function($window,$browser){return{restrict:"A",templateUrl:"views/menu311.html",link:function($scope,$element,$attrs){$scope.menu=[{title:"Get Answers",state:"faq",icon:"fa-question-circle"},{title:"Make a Payment",state:"payments",icon:"fa-usd"},{title:"Report an Issue",state:"report",icon:"fa-exclamation-triangle"},{title:"Check Status",state:"status",icon:"fa-wrench"}]}}}).directive("mainToggle",function($window,$rootScope){return{restrict:"A",scope:{mainToggle:"@",mainToggleNest:"@",mainToggleForce:"@",mainToggleEnter:"@"},link:function($scope,$element,$attrs){var select=$scope.mainToggleNest?"-"+$scope.mainToggleNest:"";$scope.mainToggleEnter?toggleMain($scope.mainToggle,$scope.mainToggleForce,select):$element.on("click",function(){console.log($rootScope.currentYPosition()),$rootScope.currentYPosition()<300&&$("html, body").animate({scrollTop:$("#wrapper-311").offset().top-70},300),toggleMain($scope.mainToggle,$scope.mainToggleForce,select)})}}}).directive("menuClick",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$element.on("click",function(event){return jQuery(".app-wrap").toggleClass("show-nav"),$attrs.menuClick&&"return-false"==$attrs.menuClick?(event.stopPropagation(),!1):void 0})}}}),angular.module("app.lazyCompile",[]).directive("compile",["$compile",function($compile){return{scope:{compile:"="},link:function(scope,element,attrs){var voidCompile=scope.$watch("compile",function(value){value&&"false"!=value&&(element.html(value),$compile(element.contents())(scope),voidCompile())})}}}]),angular.module("app.proudcityImage",[]).factory("pcImage",function($resource,$rootScope){return $resource($rootScope.proudcityApi,{format:"json"},{})}).directive("proudcityImage",function($window,$browser,$http,$rootScope){return{restrict:"A",templateUrl:"views/proudcityImage.html",replace:!1,link:function($scope,$element,$attributes){function selectImage(){if(void 0==$scope.settings.header||""==$scope.settings.header.backgroundImage&&""==$scope.settings.header.backgroundColor){if(0!=$scope.settings.suggested_image)var image=$scope.settings.suggested_image;else var image=$scope.settings.images[Math.floor(Math.random()*$scope.settings.images.length)];0!=image.url&&($scope.settings.header.backgroundImage=image.url)}}void 0==$scope.settings||void 0==$scope.settings.images?$http.get($rootScope.proudcityApi+"images?city="+$scope.location.city+"&state="+$scope.location.state).then(function(response){angular.extend($scope.settings,response.data),selectImage()}):selectImage(),$scope.colors=["#2196F3","#FFFFFF","#000000","#546476","#A973A9","#456D9C","#5A97C4","#71B7BC","#9BBF6A","#8897A7","#E76C6D","#ED9356","#E3B14D","#997C61"],$scope.blackwhite=["white","black"],$scope.align=["left","center","right"],$scope.overlay=!1,$scope.open=function(){$scope.overlay=!0,console.log("asdf")},$scope.close=function(){$scope.overlay=!1},$scope.setValue=function(sectionName,variableName,value){$scope.settings[sectionName][variableName]=value;var data={city:$scope.location.city,state:$scope.location.state};data[sectionName]=$scope.settings[sectionName],console.log(data),$http.post($rootScope.proudcityApi+"save",data).then(function(response){},function(response){})}}}}),angular.module("app.social",[]).factory("Social",function($resource,$rootScope){return $resource($rootScope.socialApi,{format:"json",action:"query",callback:"JSON_CALLBACK"},{})}).controller("SocialController",["$scope",function($scope){$scope.social=[{service:"twitter",title:"SLC Police Dept.",account:"@slcpd",text:'50 kids get to go to @<a href="http://www.twitter.com/Target">Target</a> with officers for #<a href="http://twitter.com/search/%23shopwithacop">shopwithacop</a>.<a href="http://t.co/MD1NjV3wxF">http://t.co/MD1NjV3wxF</a>',date:1360413309421},{service:"instagram",account:"slcmayorsoffice",image:"https://scontent.cdninstagram.com/hphotos-xaf1/t51.2885-15/s320x320/e15/11352163_1628925684059367_490994342_n.jpg",text:"This original Salt Lake City streetcar from the 1800s resides at the Daughters of Utah Pioneers Museum on Main Street in #SaltLakeCity. #TBT #ThrowBackThursday",date:1360413309421},{service:"instagram",account:"slcairport",image:"https://scontent.cdninstagram.com/hphotos-xfa1/t51.2885-15/s320x320/e15/11856776_1632851626969972_1492883218_n.jpg",text:'<span class="section-text">A diversion from @denairport last night gave us a chance to see this beautiful @Lufthansa 747-400 #avgeek #SLC</span>',date:1360413309421},{service:"twitter",title:"SaltLakeCity Council",account:"@slcCouncil",image:"",text:'<span class="section-text"><span class="twitter-user"><a href="https://www.twitter.com/slcCouncil"><strong>SaltLakeCity Council </strong>@slcCouncil</a></span>At tonight\'s meeting, the Council discussed a bond proposal and held a Truth in Taxation Hearing. Summary: <a href="http://t.co/lWKG3FobQ4">http://t.co/lWKG3FobQ4</a> #<a href="http://twitter.com/search/%23utpol">utpol</a></span>',date:1360413309421},{service:"twitter",account:"slcmayorsoffice",image:"https://scontent.cdninstagram.com/hphotos-xaf1/t51.2885-15/s320x320/e15/11358289_751601898299703_684513099_n.jpg",text:'<span class="section-text">#Repost @slcfarmersmarket Come down to Pioneer Park for the Tuesday Harvest Market! There\'s a beer garden, Bocce Ball, yoga, food trucks and the best produce in the state!</span>',date:1360413309421},{service:"twitter",title:"SLC Police Dept",account:"@slcpd",text:'<span class="section-text"><span class="twitter-user"><a href="https://www.twitter.com/slcpd"><strong>SLC Police Dept. </strong>@slcpd</a></span>#<a href="http://twitter.com/search/%23WatchLog">WatchLog</a>: Tues, 8/11/15, Shooting, <a href="http://t.co/lMtahKsgIv">http://t.co/lMtahKsgIv</a></span>',date:1360413309421},{service:"newspaper-o",title:"Inspiring Outdoor Stewards",account:"",image:"",text:'<span class="section-text">Salt Lake City was selected as one of the first 50 cities to participate in a nationwide movement to inspire and encourage the ...</span>',date:1360413309421},{service:"newspaper-o",title:"SLCgreen is Hiring",text:'<span class="section-text">Title: Electric Vehicle Charging &amp;&nbsp;Clean Transportation Project Coordinator Duration: 15 – 20 hours per week for ...</span>',date:1360413309421},{service:"newspaper-o",title:"Summary of the June 2 City Council Meeting",text:"The Council continued its budget hearing, at which four people spoke. The Council will continue the public hearing to June 9 and will continue to discuss the Fiscal Year 2015-16 budget before adopting it in the coming weeks.",date:1360413309421}],$scope.shuffle=function(){$scope.$emit("iso-method",{name:"shuffle",params:null})}}]).directive("socialWall",function($window,$browser,$http,$timeout){return{restrict:"A",controller:"SocialController",templateUrl:"views/social.html",link:function($scope,$element,$attributes){$timeout(function(){var imgLoad=imagesLoaded($element);imgLoad.on("always",function(instance){$element.find("[isotope-container]").isotope("reLayout")})},0)}}}),angular.module("app.googleNews",[]).directive("googleNews",function($window,$browser,$http){return{restrict:"A",template:'<div ng-repeat="item in news | limitTo:4"><h5><a ng-href="{{item.link}}" href="" target="blank">{{item.title}}</a></h5><p ng-bind-html="item.contentSnippet"></p></div><p><em>Read more from <a href="http://google.com/news?q={{address}}" target="_blank">Google News</a></em></p>',replace:!1,link:function($scope,$rootScope,$element){$scope.address=$scope.location.city+"+"+$scope.location.state;var googleNewsUrl="https://news.google.com/news?pz=1&cf=all&ned=us&hl=en&output=rss&q="+$scope.address;$http.jsonp("//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q="+encodeURIComponent(googleNewsUrl)).success(function(data){$scope.news=data.responseData.feed.entries})}}}),angular.module("app.map",[]).directive("foursquareMap",function($window,$browser,$http,$rootScope){return{restrict:"A",templateUrl:"views/directives/map.html",replace:!1,scope:{foursquareMap:"="},link:function($scope,$rootScope,$element){$scope.details={},$("#details-close").click(function(){return $("#map-wrapper").removeClass("details-open"),!1}),$scope.$watch("foursquareMap",function(settings){function addLayer(name,type,zoom,params,active){active=void 0==active?!1:active;var link=document.createElement("a");link.href="#",link.className=active?"active":"",link.innerHTML=name,link.onclick=function(e){e.preventDefault(),e.stopPropagation();for(var key in mapLayers)map.removeLayer(mapLayers[key]);switch(void 0!=gridControl&&(map.removeControl(gridControl),gridControl=void 0),map.setView(new L.LatLng(config.lat,config.lng),zoom,{animate:!0}),$("#menu-ui a.active").removeClass("active"),map.invalidateSize(),this.className="active",type){case"foursquare":if(Array.isArray(params.query))for(var i=0;i<params.query.length;i++)addFoursquareLayer(params.query[i],"small");else addFoursquareLayer(params.query,"large");map.attributionControl.setPrefix('Data from <a href="http://foursquare.com">Foursquare</a>');break;case"seeclickfix":addSeeClickFixLayer("closed"),addSeeClickFixLayer("open"),addSeeClickFixLayer("acknowledged"),map.attributionControl.setPrefix('Data from <a href="http://seeclickfix.com">SeeClickFix</a>');break;case"drupal":addFoursquareLayer(params.query),map.attributionControl.setPrefix('Data from <a href="/">this website</a>');break;case"mbtiles":tile=L.mapbox.tileLayer(params.url).addTo(window.activeLayer),grid=L.mapbox.gridLayer(params.url).addTo(window.activeLayer),gridControl=L.mapbox.gridControl(grid,{follow:!0}).addTo(map)}},active&&$(link).trigger("click"),layers.appendChild(link)}function addFoursquareLayer(query,size){var url=config.apiUrl+"v2/venues/explore?ll="+config.lat+","+config.lng+"&query="+query+"&client_id="+config.clientKey+"&client_secret="+config.clientSecret+"&v=20140601";$.getJSON(url,{},function(data){for(var venues=data.response.groups[0].items,geojson=(L.mapbox.featureLayer(),{type:"FeatureCollection",features:[]}),i=0;i<venues.length;i++){var category=venues[i].venue.categories[0].name,color="#997C61",icon="star";-1!=category.indexOf("Library")?(icon="library",color="#A973A9"):-1!=category.indexOf("School")||-1!=category.indexOf("College")||-1!=category.indexOf("University")?(icon="college",color="#ED9356"):-1!=category.indexOf("Police")?(icon="police",color="#456D9C"):-1!=category.indexOf("Fire")?(icon="fire-station",color="#E76C6D"):-1!=category.indexOf("Post")?(icon="post",color="#5A97C4"):("park"==query||-1!=category.indexOf("Park"))&&(icon="park2",color="#9BBF6A"),geojson.features.push({type:"Feature",properties:{title:venues[i].venue.name,"marker-color":color,"marker-size":size,"marker-symbol":icon,url:void 0!=venues[i].venue.url?venues[i].venue.url:void 0,details:venues[i].venue},geometry:{type:"Point",coordinates:[venues[i].venue.location.lng,venues[i].venue.location.lat]}})}mapLayers[query]=L.mapbox.featureLayer().setGeoJSON(geojson),mapLayers[query].on("mouseover",function(e){e.layer.openPopup()}).on("mouseout",function(e){e.layer.closePopup()}).on("click",function(e){var props=e.layer.feature.properties.details;$("#map-wrapper").addClass("details-open"),$scope.details=props,$scope.$apply();var url="https://maps.googleapis.com/maps/api/place/search/json?"+$.param({location:e.layer.feature.geometry.coordinates[1]+","+e.layer.feature.geometry.coordinates[0],type:query.replace(" station",""),search:props.title,key:"AIzaSyAqSVs6Hsk1EjKiSa4TV9fykhB7K3ijkaM",sensor:!0,radius:250});$.getJSON($scope.$parent.$root.proxyUrl+"?url="+encodeURIComponent(url),{},function(data){if("OK"==data.status&&data.results[0]){var url="https://maps.googleapis.com/maps/api/place/details/json?"+$.param({key:"AIzaSyAqSVs6Hsk1EjKiSa4TV9fykhB7K3ijkaM",placeid:data.results[0].place_id});$.getJSON($scope.$parent.$root.proxyUrl+"?url="+encodeURIComponent(url),{},function(data){"OK"==data.status&&void 0!=data.result&&($scope.details.website=data.result.website,$scope.googleLocal=data.result,$scope.googleLocal.hours=void 0!=data.result.opening_hours?data.result.opening_hours.weekday_text.join("<br/>"):!1,$scope.$apply())})}})}),mapLayers[query].addTo(map)})}function addSeeClickFixLayer(status){var query="seeclickfix "+status,geojson=(L.mapbox.featureLayer(),{type:"FeatureCollection",features:[]}),url="https://seeclickfix.com/api/v2/issues?&callback=?&"+$.param({lat:config.lat,lng:config.lng,zoom:map.getZoom()-1,per_page:50,sort:"created_at",status:status});$.getJSON(url,{},function(data){for(var venues=data.issues,i=0;i<venues.length;i++){var props=venues[i],color="Acknowledged"==props.status?"#E3B14D":"Open"==props.status?"#E76C6D":"Closed"==props.status?"#9BBF6A":"#CCCCCC";props["marker-color"]=color,props["marker-size"]="small",props["marker-symbol"]=void 0!=props.media.image_full?"star":"star-stroked",props.title=props.summary,props.description='<div class="seeclickfix-status status-'+props.status+'">'+props.status+'</div><div class="date">Reported on '+props.created_at+"</div>",geojson.features.push({type:"Feature",properties:props,geometry:{type:"Point",coordinates:[venues[i].lng,venues[i].lat]}})}mapLayers[query]=L.mapbox.featureLayer().setGeoJSON(geojson),mapLayers[query].on("mouseover",function(e){e.layer.openPopup()}).on("mouseout",function(e){e.layer.closePopup()}).on("click",function(e){$("#map-wrapper").addClass("details-open");var props=e.layer.feature.properties;$scope.seeclickfix=props,$scope.$apply()}),mapLayers[query].addTo(map)})}if(void 0!=settings){var config={clientKey:"1CAZ5UW5UDQ2F1EDEHFOULURU4K3RBWWITBOONJ2XLXPD52V",clientSecret:"GA4DAN4KLI5UM0VJ4BAZAE4SEVLIR0BC5B4UKGNVR2VJXXWN",authUrl:"https://foursquare.com/",apiUrl:"https://api.foursquare.com/",lat:settings.lat,lng:settings.lng};L.mapbox.accessToken="pk.eyJ1IjoiYWxiYXRyb3NzZGlnaXRhbCIsImEiOiI1cVUxbUxVIn0.SqKOVeohLfY0vfShalVDUw";var map=new L.mapbox.Map("map","albatrossdigital.lpkdpcjb",{center:new L.LatLng(config.lat,config.lng),zoom:15,scrollWheelZoom:!1,zoomControl:!1});new L.Control.Zoom({position:"topright"}).addTo(map),window.map=map;var gridControl,layers=document.getElementById("menu-ui"),mapLayers={},foursquareDefault=!0;44.5667==config.lat&&(addLayer("Public Transit","mbtiles",14,{url:settings.helm_civic_map.transportation,attribution:'<a href="ftp://ftp.ci.corvallis.or.us/pw/Transportation/GoogleTransitFeed/">City of Corvallis GTFS</a>'},!0),foursquareDefault=!1),foursquareDefault=!0,addLayer("All Services","foursquare",13,{query:["government","school","police station","fire station","library","post office","park"]},foursquareDefault),addLayer("Schools","foursquare",13,{query:"school"}),addLayer("Police","foursquare",12,{query:"police station"}),addLayer("Fire","foursquare",12,{query:"fire station"}),addLayer("Libraries","foursquare",13,{query:"library"}),addLayer("Post Offices","foursquare",13,{query:"post office"}),addLayer("Parks","foursquare",14,{query:"park"}),addLayer("Reported Issues","seeclickfix",14,{query:"seeclickfix"})}})}}}),angular.module("scrollTo",[]).run(["$rootScope",function($rootScope){var currentYPosition=function(){return window.pageYOffset?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0};$rootScope.currentYPosition=currentYPosition,$rootScope.scrollTo=function(eID,scrollDiv,quick){function elmYPosition(eID){if(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}}var i,startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>startY?stopY-startY:startY-stopY;if(100>distance||quick)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}}]),angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(a){if(!a.google)throw"Global `google` var missing. Did you forget to include the places API script?";return a.google}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","$document","googlePlacesApi",function(a,b,c,d,e){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?",customPlaces:"=?"},controller:["$scope",function(a){}],link:function(a,f,g,h){function i(){f.bind("keydown",l),f.bind("blur",m),f.bind("submit",m),a.$watch("selected",n)}function j(){var c,e=angular.element("<div g-places-autocomplete-drawer></div>"),f=angular.element(d[0].body);e.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"}),c=b(e)(a),f.append(c)}function k(){h.$parsers.push(o),h.$formatters.push(p),h.$render=q}function l(b){0!==a.predictions.length&&-1!==w(A,b.which)&&(b.preventDefault(),b.which===z.down?(a.active=(a.active+1)%a.predictions.length,a.$digest()):b.which===z.up?(a.active=(a.active?a.active:a.predictions.length)-1,a.$digest()):13===b.which||9===b.which?(a.forceSelection&&(a.active=-1===a.active?0:a.active),a.$apply(function(){a.selected=a.active,-1===a.selected&&r()})):27===b.which&&a.$apply(function(){b.stopPropagation(),r()}))}function m(b){0!==a.predictions.length&&(a.forceSelection&&(a.selected=-1===a.selected?0:a.selected),a.$digest(),a.$apply(function(){-1===a.selected&&r()}))}function n(){var b;b=a.predictions[a.selected],b&&(b.is_custom?a.$apply(function(){a.model=b.place,a.$emit("g-places-autocomplete:select",b.place),c(function(){h.$viewChangeListeners.forEach(function(a){a()})})}):C.getDetails({placeId:b.place_id},function(b,d){d==e.maps.places.PlacesServiceStatus.OK&&a.$apply(function(){a.model=b,a.$emit("g-places-autocomplete:select",b),c(function(){h.$viewChangeListeners.forEach(function(a){a()})})})}),r())}function o(b){var c;return b&&u(b)?(a.query=b,c=angular.extend({input:b},a.options),B.getPlacePredictions(c,function(b,c){a.$apply(function(){var d;r(),a.customPlaces&&(d=s(a.query),a.predictions.push.apply(a.predictions,d)),c==e.maps.places.PlacesServiceStatus.OK&&a.predictions.push.apply(a.predictions,b),a.predictions.length>5&&(a.predictions.length=5)})}),a.forceSelection?h.$modelValue:b):b}function p(a){var b="";return u(a)?b=a:v(a)&&(b=a.formatted_address),b}function q(){return f.val(h.$viewValue)}function r(){a.active=-1,a.selected=-1,a.predictions=[]}function s(b){var c,d,e,f=[];for(e=0;e<a.customPlaces.length;e++)c=a.customPlaces[e],d=t(b,c),d.matched_substrings.length>0&&f.push({is_custom:!0,custom_prediction_label:c.custom_prediction_label||"(Custom Non-Google Result)",description:c.formatted_address,place:c,matched_substrings:d.matched_substrings,terms:d.terms});return f}function t(a,b){var c,d,e,f=a+"",g=[],h=[];for(d=b.formatted_address.split(","),e=0;e<d.length;e++)c=d[e].trim(),f.length>0&&(c.length>=f.length?(x(c,f)&&h.push({length:f.length,offset:e}),f=""):x(f,c)?(h.push({length:c.length,offset:e}),f=f.replace(c,"").trim()):f=""),g.push({value:c,offset:b.formatted_address.indexOf(c)});return{matched_substrings:h,terms:g}}function u(a){return"[object String]"==Object.prototype.toString.call(a)}function v(a){return"[object Object]"==Object.prototype.toString.call(a)}function w(a,b){var c,d;if(null==a)return-1;for(d=a.length,c=0;d>c;c++)if(a[c]===b)return c;return-1}function x(a,b){return 0===y(a).lastIndexOf(y(b),0)}function y(a){return null==a?"":a.toLowerCase()}var z={tab:9,enter:13,esc:27,up:38,down:40},A=[z.tab,z.enter,z.esc,z.up,z.down],B=new e.maps.places.AutocompleteService,C=new e.maps.places.PlacesService(f[0]);!function(){a.query="",a.predictions=[],a.input=f,a.options=a.options||{},j(),i(),k()}()}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(a,b){var c=['<div class="pac-container" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>"];return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:c.join(""),link:function(c,d){function e(c){var d=c[0],e=d.getBoundingClientRect(),f=b[0].documentElement,g=b[0].body,h=a.pageYOffset||f.scrollTop||g.scrollTop,i=a.pageXOffset||f.scrollLeft||g.scrollLeft;return{width:e.width,height:e.height,top:e.top+e.height+h,left:e.left+i}}d.bind("mousedown",function(a){a.preventDefault()}),a.onresize=function(){c.$apply(function(){c.position=e(c.input)})},c.isOpen=function(){return c.predictions.length>0},c.isActive=function(a){return c.active===a},c.selectActive=function(a){c.active=a},c.selectPrediction=function(a){c.selected=a},c.$watch("predictions",function(){c.position=e(c.input)},!0)}}}]).directive("gPlacesAutocompletePrediction",[function(){var a=['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>','<span class="custom-prediction-label" ng-if="prediction.is_custom">&nbsp;{{prediction.custom_prediction_label}}</span>'];return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:a.join("")}}]).filter("highlightMatched",["$sce",function(a){return function(b){var c,d="",e="";return b.matched_substrings.length>0&&b.terms.length>0&&(c=b.matched_substrings[0],d=b.terms[0].value.substr(c.offset,c.length),e=b.terms[0].value.substr(c.offset+c.length)),a.trustAsHtml('<span class="pac-matched">'+d+"</span>"+e)}}]).filter("unmatchedTermsOnly",[function(){return function(a,b){var c,d,e=[];for(c=0;c<a.length;c++)d=a[c],b.matched_substrings.length>0&&d.offset>b.matched_substrings[0].length&&e.push(d);return e}}]).filter("trailingComma",[function(){return function(a,b){return b?a+",":a}}]),/*! angular-deckgrid (v0.5.0) - Copyright: 2013 - 2014, André König (andre.koenig@posteo.de) - MIT */
angular.module("akoenig.deckgrid",[]),angular.module("akoenig.deckgrid").directive("deckgrid",["DeckgridDescriptor",function(DeckgridDescriptor){return DeckgridDescriptor.create()}]),angular.module("akoenig.deckgrid").factory("DeckgridDescriptor",["Deckgrid","$templateCache",function(Deckgrid,$templateCache){function Descriptor(){this.restrict="AE",this.template='<div data-ng-repeat="column in columns" class="{{layout.classList}}"><div data-ng-repeat="card in column" data-ng-include="cardTemplate"></div></div>',this.scope={model:"=source"},this.$$deckgrid=null,this.transclude=!0,this.link=this.$$link.bind(this),this.$$templateKeyIndex=0}return Descriptor.prototype.$$destroy=function(){this.$$deckgrid.destroy()},Descriptor.prototype.$$link=function(scope,elem,attrs,nullController,transclude){var templateKey="deckgrid/innerHtmlTemplate"+ ++this.$$templateKeyIndex+".html";scope.$on("$destroy",this.$$destroy.bind(this)),angular.isUndefined(attrs.cardtemplate)?(angular.isUndefined(attrs.cardtemplatestring)?transclude(scope,function(innerHTML){var outerHTML,extractedInnerHTML=[],i=0,len=innerHTML.length;for(i;len>i;i+=1)outerHTML=innerHTML[i].outerHTML,angular.isDefined(outerHTML)&&extractedInnerHTML.push(outerHTML);$templateCache.put(templateKey,extractedInnerHTML.join())}):$templateCache.put(templateKey,elem.attr("cardtemplatestring")),scope.cardTemplate=templateKey):scope.cardTemplate=attrs.cardtemplate,scope.mother=scope.$parent,this.$$deckgrid=Deckgrid.create(scope,elem[0])},{create:function(){return new Descriptor}}}]),angular.module("akoenig.deckgrid").factory("Deckgrid",["$window","$log",function($window,$log){function Deckgrid(scope,element){var watcher,mql,self=this;this.$$elem=element,this.$$watchers=[],this.$$scope=scope,this.$$scope.columns=[],this.$$scope.layout=this.$$getLayout(),this.$$createColumns(),watcher=this.$$scope.$watchCollection("model",this.$$onModelChange.bind(this)),this.$$watchers.push(watcher),angular.forEach(self.$$getMediaQueries(),function(rule){function onDestroy(){rule.removeListener(handler)}var handler=self.$$onMediaQueryChange.bind(self);rule.addListener(handler),self.$$watchers.push(onDestroy)}),mql=$window.matchMedia("(orientation: portrait)"),mql.addListener(self.$$onMediaQueryChange.bind(self))}return Deckgrid.prototype.$$getMediaQueries=function(){function extractRules(stylesheet){try{return stylesheet.sheet.cssRules||[]}catch(e){return[]}}function hasDeckgridStyles(rule){var regexe=/\[(\w*-)?deckgrid\]::?before/g,i=0,selector="";if(!rule.media||angular.isUndefined(rule.cssRules))return!1;for(i=rule.cssRules.length-1;i>=0;i-=1)if(selector=rule.cssRules[i].selectorText,angular.isDefined(selector)&&selector.match(regexe))return!0;return!1}var stylesheets=[],mediaQueries=[];return stylesheets=Array.prototype.concat.call(Array.prototype.slice.call(document.querySelectorAll("style[type='text/css']")),Array.prototype.slice.call(document.querySelectorAll("link[rel='stylesheet']"))),angular.forEach(stylesheets,function(stylesheet){var rules=extractRules(stylesheet);angular.forEach(rules,function(rule){hasDeckgridStyles(rule)&&mediaQueries.push($window.matchMedia(rule.media.mediaText))})}),mediaQueries},Deckgrid.prototype.$$createColumns=function(){var self=this;return this.$$scope.layout?(this.$$scope.columns=[],void angular.forEach(this.$$scope.model,function(card,index){var column=index%self.$$scope.layout.columns|0;self.$$scope.columns[column]||(self.$$scope.columns[column]=[]),card.$index=index,self.$$scope.columns[column].push(card)})):$log.error("angular-deckgrid: No CSS configuration found (see https://github.com/akoenig/angular-deckgrid#the-grid-configuration)")},Deckgrid.prototype.$$getLayout=function(){var layout,content=$window.getComputedStyle(this.$$elem,":before").content;return content&&(content=content.replace(/'/g,""),content=content.replace(/"/g,""),content=content.split(" "),2===content.length&&(layout={},layout.columns=0|content[0],layout.classList=content[1].replace(/\./g," ").trim())),layout},Deckgrid.prototype.$$onMediaQueryChange=function(){var self=this,layout=this.$$getLayout();layout.columns!==this.$$scope.layout.columns&&(self.$$scope.layout=layout,self.$$scope.$apply(function(){self.$$createColumns()}))},Deckgrid.prototype.$$onModelChange=function(newModel,oldModel){var self=this;newModel=newModel||[],oldModel=oldModel||[],angular.equals(oldModel,newModel)||self.$$createColumns()},Deckgrid.prototype.destroy=function(){var i=this.$$watchers.length-1;for(i;i>=0;i-=1)this.$$watchers[i]()},{create:function(scope,element){return new Deckgrid(scope,element)}}}]);